{% extends 'base.html' %}

{% block title %}Art Xplrr{% endblock %}

{% block css %}

    <style>
        /* Percentage-based sizes must inherit from parent block elements, and
        if any of those ancestors fail to specify a size, they are assumed to be
        0 x 0 pixels; therefore, html and body must specify a size for #map to
        have height as a percentage. */
        html, body {
            height: 100%;
        }

        .row, .container-fluid {
            height: 100%;
        }

        #map {
            /*height: 92.67%;*/
            height: 50%;
        }
        #directions-panel{
            height: 50%;
            overflow: scroll;
        }
    </style>

{% endblock %}

{% block content %}


    <div class="container-fluid">
      <div class="row">

        <div class="col-xs-12" id="map"></div>
        <div class="col-xs-12" id="directions-panel"></div>

      </div><!-- close row -->
    </div><!-- close container -->

{% endblock %}

{% block javascript %}
    <!-- Google Maps -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQOKqWyayHzhpVSWddS3M9iy5a4X072Ug&v=3&libraries=places"></script>

<script type="text/javascript">
    var map;
    var latitude = {{ lat }};
    var longitude = {{ lng }};

    var initialLocation = new google.maps.LatLng(latitude, longitude);

    function init(){
        initMap();
    }

    function initMap(){

        var directionsDisplay = new google.maps.DirectionsRenderer({suppressInfoWindows:true});
        var directionsService = new google.maps.DirectionsService();

        // Create a map object and specify the DOM element for display.
        map = new google.maps.Map(document.getElementById('map'), {
            center: initialLocation,
            zoom: 12,
            mapTypeControl: false,
            streetViewControl: false,
        });

        // directionsDisplay.setMap(map);
        directionsDisplay.setPanel(document.getElementById('directions-panel'));

        calculateAndDisplayRoute(directionsService, directionsDisplay);
    }

    function calculateAndDisplayRoute(directionsService, directionsDisplay) {
        var start = initialLocation;
        var end = initialLocation;
        var waypts = [];

        console.log("IM IN CALCROUTE")

        var mapInputs = {
            'latitude': latitude,
            'longitude': longitude
        };

        console.log('printing map inputs');
        console.log(mapInputs);
        
        $.get('/map.json', mapInputs, get_waypoints);
        function get_waypoints(data){
            console.log(data);

            var responseWaypoints = data.waypoints;

            for (var i = 0; i < responseWaypoints.length; i++) {
                waypts.push({
                    location: responseWaypoints[i],
                    stopover: true,
                   
                });
                 var infowindow = new google.maps.InfoWindow({
                    content: 'hello'
                });
              }

            console.log('printing responseWaypoints');
            console.log(responseWaypoints);

            console.log('printing waypts');
            console.log(waypts);
    
        directionsService.route({
          origin: start,
          destination: end,
          waypoints: waypts,
          optimizeWaypoints: true,
          travelMode: 'WALKING',
        }, function(response, status) {
          if (status === 'OK') {
            directionsDisplay.setDirections(response);
            directionsDisplay.setMap(map);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
    }
}

    google.maps.event.addDomListener(window, 'load', init);
</script>

{% endblock%}
